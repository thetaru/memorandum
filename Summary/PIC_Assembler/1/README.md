# マイコンとPIC16F84
ここではマイコンの一般的な説明のみを記述し、PIC16F84については書籍参照とする。
## 1.1 マイコンとは
### 1.1.1 マイコンとその利用
マイコンは、電卓・オフィス機器用LSIを開発する過程で誕生し、当時のマイコンは2300程度のトランジスタが集積され構成された。  
  
マイコンに集積できるトランジスタ数は半導体集積技術の発展とともに増加し、現在では数千万個〜数億個のトランジスタを集積するものがコンピュータの中央処理装置(CPU)として使われている。
### 1.1.2 マイコンの構成
演算装置に中央処理装置(CPU)、記憶装置にICメモリ、入力装置や出力装置とのデータの受け渡しにインターフェースという回路(LSI)を使用する。
### 1.1.3 マイコンの動作
CPUは、メモリに記憶されたプログラムを逐次実行する。  
命令の実行は、`読み出し -> 解読 -> 実行`の順に行われる。  
それぞれの工程の内容は以下の通りである。
1. 読み出し(フェッチ)
> メモリに格納されている機械語命令をCPUの命令レジスタに読み出す。  
> 命令の実行を終えるたびに次の命令のフェッチを行う。
2. 解読(デコード)
> 命令レジスタにフェッチされた機械語命令をデコータ(解読器)によって解読する。
3. 実行(エグゼキュート)
> 解読された命令に従い、マイコン内の各装置に指定を出して、命令の実行を行う。

### 1.1.4 マイコンの処理性能
マイコンの処理性能は、基準となる処理を実行したときの処理時間で比較する。  
処理時間は次式で求められる。
```
処理時間(s) = サイクルタイム * CPI * 命令数
```
### ■ サイクルタイム(cycle time)
マイコンは動作クロックというパルス信号に同期して処理を行う。  
1クロックあたりの時間T(s)をサイクルタイムといい、1秒あたりの動作クロック数f(Hz)を動作周波数という。  
```
        1             2             3                 n-1            n
    +------+      +------+      +------+           +------+      +------+      +---
    |      |      |      |      |      |    ...    |      |      |      |      |     
 ---+      +------+      +------+      +---     ---+      +------+      +------+
    <------------->
    T: cycle time(s)
    <-------------------------------------------------------------------------->
                                     1(s)
```
```
動作周波数: f = n (Hz)
サイクルタイム: T = 1/n (s)
```
### ■ CPI(cycles per instruction)
マイコンが1命令あたりに使用する平均クロック数をCPIという。
```
          1回目         2回目          3回目
    +------+      +------+      +------+      +---
    |      |      |      |      |      |      |
 ---+      +------+      +------+      +------+
    <------------->
         fetch
                  <------------->
                      decode
                                <------------->
                                    execute
```
上の図の場合、`読み出し -> 解読 -> 実行`の一所作に対し3回のクロックで処理されるため、CPI=3である。  
※ 例はちょうど1クロックごとに処理が完了しているが実際はもっと汚いはずである。
### ■ 命令数
処理能力の目安として、1秒間に実行できる命令数を考える。  
- MIPS(million instructions per second)
> 1秒間に実行できる命令数(100万単位で表す)
- FLOPS(floating-point operations per seconds)
> 1秒間に実行できる浮動小数点演算数

### 問1.3
1分間に870,000,000回の命令を実行するマイコンの処理能力は何MIPSか？
```
(870 * 10^6) / 60 / 10^6 = 14.5MIPS
```

### 1.1.5 マイコンの分類
一般的にマイコンは命令形態、演算桁数、利用形態で分類される。
### ■ 命令形態での分類
基本命令の記述形態より次のように分類される。
- CISC型
> 命令長やクロック数が一定でないため、最大動作周波数は上がりにくい。
> ビジネス用、マルティメディア用などの用途に特化した命令を多く持ち、1つの命令で多くを行う複合化命令を備える。  
- RISC型
> 命令長は一定であり、1クロックで1命令の実行を行うため、最大動作周波数は上げやすい。  
> しかし、複雑な処理は命令を組み合わせて実行するため、CISC型以上に最大動作周波数を上げる必要がある。
- VLIW型
> 命令長が長い複合命令を使用し、複数の処理を並列に実行する。  
> 複数の実行ユニット(命令を実行する部分)を1つのマイコンに装備する。  
> 命令はパケット(処理のまとまり)に分割し、各実行ユニットがパケット単位で実行することで並行処理する。
### ■ 演算桁数での分類
マイコンの演算桁数が4ビットの場合と8ビットの場合で演算処理能力に違いが出る。
```
40 + 24 を考える。
# 4ビットの場合
                +-+ +-+ +-+ +-+                       +-+ +-+ +-+ +-+
        0 0 1 0 |1| |0| |0| |0|               0 0 0 1 |1| |0| |0| |0| 
                +-+ +-+ +-+ +-+                       +-+ +-+ +-+ +-+
4ビットの場合、データを4ビット単位で分割しなくてはならないので、一度に40 + 24は演算できない。
そのため、最低2回以上の演算が必要となる。

# 8ビットの場合
+-+ +-+ +-+ +-+ +-+ +-+ +-+ +-+       +-+ +-+ +-+ +-+ +-+ +-+ +-+ +-+
|0| |0| |1| |0| |1| |0| |0| |0|       |0| |0| |0| |1| |1| |0| |0| |0| 
+-+ +-+ +-+ +-+ +-+ +-+ +-+ +-+       +-+ +-+ +-+ +-+ +-+ +-+ +-+ +-+
8ビットの場合、データを8ビット単位で分割するため、一度に40 + 24は演算できる。
```
このように演算装置の演算桁数の違いから演算回数に差が出るため、演算処理能力の1つの目安となる。
### ■ 利用形態での分類
- 汎用向けマイコン
> PCなど汎用性のあるコンピュータシステムのCPU(中央処理装置)として利用されるマイコンを指す
- 特定用途向けマイコン
> 大小さまざまなLSI規模の特定用途向けマイコンが用途に応じて作られている。  
> 特に、制御向けのマイコンをクロコントローラともいう。

## 1.2 PIC16F84
書籍参照

## 1.3 プログラム開発
