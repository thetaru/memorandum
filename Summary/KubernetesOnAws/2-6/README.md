# バッチアプリケーションのビルドとデプロイ
スケジュール起動されるバッチアプリケーションのビルドとデプロイを行います。
## 2-6-1 事前準備
バッチアプリケーションは、APIアプリケーションと同様、JavaでSprint Bootを使用して構築されたアプリケーションです。  
アプリケーションが起動すると、環境変数で指定されたS3バケット上のファイルを取得し、ファイルの内容をデータベースに登録します。  
このときアクセスするバケットは、フロントエンドコンテンツを配置したバケットとは異なり、特定のユーザしかアクセスできない設定とします。  
  
このアプリケーションをk8sのCronJobという仕組みを用いて、定期実行させます。
## 2-6-2 バッチアプリケーションのビルドとコンテナイメージの作成
バッチアプリケーションのソースコードをビルドし、コンテナイメージを作成します。
### ■ ソースコードのビルド
バッチアプリケーションのソースコードは、[ここ](https://github.com/kazusato/k8sbook/tree/6d9d359fcf1cad348715fd2e6fe8e35cde725df7/batch-app)からもってきてください。  
バッチアプリケーションは、APIアプリケーション同様、Gradleでビルドを行います。
```
# cd k8sbook/batch-app
# ./gradlew clean build
```
正常にビルドが行われると`BUILD SUCCESSFUL`と表示され、作業フォルダ配下の`build/libs`以下に`batch-app-1.0.0.jar`ファイルが作成されます。
### ■ コンテナイメージの作成
コンテナイメージを作成します。
```
# docker build -t k8sbook/batch-app:1.0.0 --build-arg JAR-FILE~build/libs/batch-app-1.0.0.jar .
```
## 2-6-3 ECRレポジトリの作成
作成したコンテナイメージをECR上に登録するため、バッチアプリケーション用のリポジトリを作成します。  
マネジメントコンソールの`コンピューティング`から`Elastic Container Registry`を開き、`リポジトリの作成`を押してください。  
  
![Image01](./images/2-6-1.png)
  
`リポジトリ名`に`k8sbook/batch-app`と入力し、`リポジトリの作成`を押します。
  
![Image02](./images/2-6-2.png)
  
正常に作成できると、次のような画面が表示されます。
  
![Image03](./images/2-6-3.png)
  
## 2-6-4 コンテナイメージのpush
