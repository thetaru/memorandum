# ストリームにかかわるライブラリ関数
## 6.1 stdio
### ■ バッファリング
読み込み側を例にして説明します。  
read()は、バイト単位の入力しかできないので、stdioは一時的にデータを保存する場所(バッファ)を用意します。  
そしてread()を使ってバッファに入力し、プログラムから1バイトほしいと言われたらバッファから1バイト取って返します。  
このようにバッファ経由でデータをやりとりすることを、バッファリングといいます。
### ■ バッファリングモード
書き込み側の場合も読み込みと同様にバッファが必要になります。  
バイト単位や行単位の出力を受け、バッファがいっぱいになったらwrite()で書き出します。  
ただし、例外があります。  
1. バッファがいっぱいになったタイミングがわからないこと
> 特にストリームが端末とつながっている場合バッファがいついっぱいになるのかわからないので、改行('\n')が書き込まれた時点でwrite()します。
2. stdioストリームがアンバッファードモードになっていること
> アンバッファードモードのstdioストリームに書き込むと、バッファリングせずにwrite()されます。
3. stdioストリームが標準エラー出力に対応するストリームstderrになっていること
> stderrは、例外的に最初からアンバッファードモードになっています。エラーメッセージをユーザにすぐ見せたいためです。

### ■ FILE型
システムコールでは、ストリームを指すのにファイルディスクリプタ(整数)を使っていました。  
一方、stdioではFILE型へのポインタを使います。  
※ FILE型は、typedefで定義された型で、ファイルディスクリプタとstdioバッファの内部情報が入っています。

### ■ stdioでの標準入出力
システムコールでは、標準入力や標準出力するために、それぞれに対応するファイルディスクリプタ(やそのマクロ)が提供されていました。  
それに対応する形でstdioにも標準入力や標準出力を表現するFILE\*型の変数が用意されています。
|ファイルディスクリプタ|マクロ名|stdioでの変数名|意味|
|:---|:---|:---|:---|
|0|STDIN_FILENO|stdin|標準入力|
|1|STDOUT_FILENO|stdout|標準出力|
|2|STDERR_FILENO|stderr|標準エラー出力|

### ■ fopen(3)
fopen()は、stdioにおいてシステムコールのopen()に対応するAPIです。
### Syntax - fopen
```c
#include <stdio.h>

FILE *fopen(const char *path, const char *mode);
```
fopen()は、ファイルをパスで指定し、そのファイルにつながるストリームをつくり、それを管理するFILE型へのポインタを返します。  
何らかの理由で失敗した場合はNULLを返し、原因を表す定数をerrnoにセットします。  
第2引数modeにはストリームの性質を指定します。
|値|対応するopen(2)のmode|意味|
|:---|:---|:---|
|"r"|O_RDONLY|読み込み専用</br>ファイルはあらかじめ存在しなくてはならない|
|"w"|O_WRONLY\|O_CREAT\|O_TRUNC|書き込み専用</br>ファイルが存在しなければ作成し、存在する場合はサイズを0にして書き込む|
|"a"|O_WRONLY\|O_CREAT\|O_APPEND|追加書き込み専用</br>ファイルが存在しなければ作成し、存在する場合はファイルの末尾から書き込む|
|"r+"|O_RDWR|読み書き両用</br>ファイルはあらかじめ存在しなくてはならない|
|"w+"|O_RDWR\|O_CREAT\|O_TRUNC|読み書き両用</br>ファイルが存在しなければ作成し、存在する場合はサイズを0にして書き込む|
|"a+"|O_RDWR\|O_CREAT\|O_APPEND|読み書き両用</br>ファイルが存在しなければ作成し、存在する場合はファイルの末尾から書き込む|

### ■ fclose(3)
fclose()は、stdioにおいてシステムコールのclose()に対応するAPIです。
### Syntax - fclose
```c
#include <stdio.h>

int fclose(FILE *stream);
```
fclose()は、ストリームを閉じます。fopen()で開いたファイルはfclose()で閉じなければいけません。  
fclose()は成功すれば0を返します。失敗すると定数EOFを返し、失敗の原因を表す定数をerrnoにセットします。  
※ EOFはstdio.hで定義されるマクロで、通常は-1です。
## 6.2 バイト単位の入出力
バイト単位の入出力APIで代表的なのはfgetc()とfputc()です。
### ■ fgetc(3)、fputc(3)
```c
#include <stdio.h>

int fgetc(FILE *stream);
int fputc(int c, FILE *stream);
```
fgetc()は、引数のstreamから1バイト読み込んで返し、ストリームが終了した場合はEOF(:=-1)を返します。  
  
fputc()は、引数のstreamにcバイトを書き込みます。  
> fgetc()で取得したバイトをfputc()にそのまま渡すことができるようになっています。
### ■ getc(3)、putc(3)
