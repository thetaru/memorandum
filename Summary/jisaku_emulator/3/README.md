# 3.1 プログラムの配置
## 配置場所の特性
CPUはメモリ上のプログラムのみ実行できます。  
主記憶装置(メモリ)は揮発性をもつため、電気の供給を断つと記憶内容が消失してしまいます。  
そのため、CPUに実行される前のプログラムは不揮発性メモリである補助記憶装置(HDDやSSD)に配置します。

## プログラムの実行
補助記憶装置に配置した(機械語)プログラムをCPUに実行するには、まずプログラムを主記憶装置に移動させる必要があります。  
その役割はプログラムローダが担当し、補助記憶装置から主記憶装置へ読み出します。  
その後、プログラムローダは読み出したプログラムの先頭へジャンプし、目的のプログラムを実行します。

## プログラムローダのパラドックス
プログラムローダもプログラムであるため、CPUによって実行される機械語プログラムです。  
プログラムローダ自身も補助記憶装置に格納されるので、誰がプログラムローダを補助記憶装置から主記憶装置に読み出すのでしょうか?  

## BIOSの役割
実はBIOSがプログラムローダを主記憶装置に読み出しています。  
BIOSは不揮発性の記憶装置(マザボ上のROM)に書き込まれており、CPUにメモリと同列に接続されます。  
そのため、CPUからメモリと同様にアクセスでき、コンピュータに電源を入れた直後からそのまま実行することができます。  
BIOSには、補助記憶装置からOSをメモリ上に読み出し、そこへジャンプするようなプログラムが書き込まれており、これがプログラムローダの連鎖の起点となります。  
※ OSを読みだした際にプログラムローダも読み出される認識でOK?

## データの格納方式
機械語プログラムはさまざまな形式で補助記憶装置に格納されます。  
一番簡単なのは、機械語プログラムそのままのバイト列を格納する方法です。  
この方法をRaw Binaryといいます。(補助記憶装置にMBRという特殊な領域に書き込むのに使います)  
機械語列そのままのデータなので、メモリに読み出して先頭にジャンプするだけで実行できます。

## 実行ファイルの形式
WindowsならPE形式、MacならMach-O形式、Unix系ならELF形式が主流となります。  
いずれの形式も機械語列のバイト列にヘッダを付与したファイルとなっています。  
ヘッダ部分には、機械語のバイト数や各セクションのサイズなどの管理情報が含まれており、それぞれのOSでソフトウェアの動作を管理するのに使います。  
  
どの実行可能ファイルの形式であっても、基本的にメモリの特定の番地に配置する必要があります。  
もしずれた位置に配置すると、メモリ番地を扱う命令がうまく動作しなくなります。

## org疑似命令について
これまで、アセンブリ言語で書かれたプログラムは0番地から配置されることになっていましたが、実は先頭の番地を変更するための機能があります。  
その機能を持つのがorg疑似命令で、プログラムの配置場所をアセンブラに伝える役割があります。  
例えば、`org 0x7c00`と書けば、そのプログラムを0x7c00に配置したときにうまく動くように、アセンブラがラベルの番地を計算します。
