# Raw Device Mapping(RDM)
:warning: 今はWebUI上から"設定の編集"より割り当て可能です :warning:  
ESXi上のVMから**物理ストレージサブシステム上のLUNに直接アクセスする**仕組み。  
VMはVMFSボリュームにアクセスしていると見せかけて、実際はマッピング先の内臓HDDやLUNに接続します。  
(マッピングファイル→VMFSボリューム→物理ボリュームの流れでアクセスする物理ボリュームがVMFSボリュームとして認識されるかどうかは問題ではない)  
ESXi本体が壊れても物理HDDを引っこ抜いて他端末に認識させれば救済可能できる。  

|OS|バージョン|
|:---|:---|
|ESXi|6.7|

|互換モード|説明|
|:---|:---|
|物理互換モード|最低限の仮想化を行う。スナップショットは不可能だがSCSIコマンドの受付が可能|
|仮想互換モード|完全な仮想化を行う。VMFSボリュームとして認識されスナップショットに対応|

## ■ ディスク識別子の確認
VMの参照先に指定する物理HDDの識別子を確認します。
### コマンドで確認する方法
```
# ls -l /vmfs/devices/disks
```
### vSphere Web Client上から確認する方法
「ストレージ」-「デバイス」よりHDDを選択し**パス情報**から確認できます。
## ■ マッピングファイルの保存先
```
### 物理互換
# vmkfstools -z <対象HDDのパス情報> </vmfs/volumes/<任意のボリューム>/rdm_disk.vmdk>

### 仮想互換
# vmkfstools -r <対象HDDのパス情報> </vmfs/volumes/<任意のボリューム>/rdm_disk.vmdk>
```
物理互換モードのvmdkはパススルー、仮想互換モードのvmdkは非パススルーであることが確認でき、いずれも「Raw Device Mapping」であることが確認できます。
```
### 確認
# vmkfstools -q /vmfs/volumes/<任意のボリューム>/rdm_disk.vmdk>
```
## ■ VMへの割り当て
「設定の編集」-「ハードディスクの追加」-「既存のハードディスク」より作成したvmdkを選択して割り当てます。 
