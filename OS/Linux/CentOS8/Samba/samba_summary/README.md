# sambaまとめ
## ■ プロセス
|プロセス|説明|
|:---|:---|
|smbd|ファイル共有、認証など|
|nmbd|ブラウジング機能、NetBIOS名前解決、WINSサーバなど|
|winbindd|Winbind機能|

## ■ ポート番号
|ポート番号|プロトコル|プロセス|説明|
|:---|:---|:---|:---|
|137|UDP|nmbd|NetBIOS名前解決やブラウジング|
|138|UDP|nmbd|NetBIOS名前解決やドメインログオン|
|139|TCP|smbd|ファイル共有|
|445|TCP|smbd|ファイル共有|

## ■ smb.conf
## globalセクション
サーバ全体に関するパラメータを設定するセクションです。
|パラメータ|説明|値|
|:---|:---|:---|
|workgroup|sambaサーバが所属するワークグループ名もしくはドメイン名を指定する。|文字列(ワークグループ名またはドメイン名)|
|server role|sambaサーバの動作モードを指定する。|任意|
|netbios name|sambaサーバのNetBIOS名を指定する。|文字列|
|server string|サーバに関する説明を記述する。|文字列|
|hosts allow|接続を許可するIPアドレスを指定する。|文字列(IPアドレス)|
|hosts deny|接続を拒否するIPアドレスを指定する。|文字列(IPアドレス)|
|guest account|アカウントが存在しないユーザにゲストとしてアクセスする場合に利用する。|文字列(ユーザ名)|
|map to guest|sambaユーザとして認証できなかった場合の動作を指定する|Never \| Bad User \| Bad Password|
|log file|ログファイルを指定する。</br>ログフォーマットを変更することもできる。|文字列(フルパス名)|
|log level|出力するログのレベルを指定する。|0 ~ 10|
|max log size|ログファイルの最大サイズを指定する。0の場合は無制限となる。|数値(KB単位のサイズ)|
|encrypt passwords|暗号化パスワードを利用する。|Yes \| No|
|logon script|ログオン時に実行するスクリプトファイルを指定する。|文字列(フルパス名)|

## ファイル共有セクション
ファイル共有に関するアクセス制御の設定を定義するセクションです。  
セクション名が共有名になることに気をつけましょう。
|パラメータ|説明|
|:---|:---|
|comment|コメントを指定する。|
|browseable|ブラウジングした際に表示されるかどうかを指定する。ただし、共有名を直接指定するとアクセス可能。|
|writable|書き込みを許可するかどうかを指定する。|
|read only|読み込みのみにするかどうかを指定する。|
|write list|書き込みが例外的に許可されるユーザを指定する。(カンマ区切りで複数選択可)</br>グループによる指定をする場合は、グループ名の前に@を付ける。|
|path|共有ディレクトリのパスを指定する。|
|force user|共有内に作成するファイルやディレクトリの所有者、所有グループを、強制的に指定したユーザーにする。|
|force group|共有内に作成するファイルやディレクトリの所有者、所有グループを、強制的に指定したグループにする。|
|hide dot files|隠し属性を適用するかどうかを指定する。|
|veto files|表示もアクセスもさせたくないファイルやディレクトリを指定する。|
|create mask|ファイルに適用可能なパーミッション(デフォルトは0744)|
|directory mask|ディレクトリに適用可能なパーミッション(デフォルトは0755)|
|force create mask|必ずファイルに適用されるパーミッション(デフォルトは0000)|
|force directory mask|必ずディレクトリに適用されるパーミッション(デフォルトは0000)|
|valid users|ファイル共有への接続を許可するユーザーを指定する。(スペース区切りで複数選択可)</br>グループによる指定をする場合は、グループ名の前に@を付ける。|
|invalid users|ファイル共有への接続を拒否するユーザーを指定する。(スペース区切りで複数選択可)</br>グループによる指定をする場合は、グループ名の前に@を付ける。|
|guest ok|共有のゲストアクセスを許すかどうか指定する。</br>この設定は、map to guestの指定がなされていないと有効にならない。|
|guest only|共有のアクセスをすべてゲスト権限にするかどうか指定する。</br>この設定は、map to guestの指定がなされていないと有効にならない。|
|public|共有のゲストアクセスを許すかどうか指定する。|

※ `guest only`と`public`とではファイル作成時のUID/GIDで差がでる。

## ■ 認証の設定
`security`,`passdb backend`ともにglobalセクションに記述すること。
## security
|security|説明|
|:---|:---|
|user|ユーザー名とパスワードでローカル認証を行う。|
|share|パスワードのみで認証を行う。|
|domain|ドメインコントローラにより認証を行う。|
|ads|ADドメインのドメインコントローラにより認証を行う。|

## passdb backend
### tdbsam
- バイナリ形式のデータベースファイル（/etc/samba/passdb.tdb）にユーザー情報を格納する。

```
passdb backend = tdbsam:/etc/samba/passdb.tdb
```

### ldapsam
- LDAPサーバにユーザ情報を格納する。
- 多数のユーザーを扱う場合に適している。

```
passdb backend = ldapsam:ldap://LDAPサーバー名[:ポート番号]
```
