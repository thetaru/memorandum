# キャッシュについての設定
## キャッシュ機能
設定例です。環境に応じて読み替えてください。
```
# メモリ上のキャッシュ総量を増やす
cache_mem 2048 MB

# メモリ上に保存するキャッシュの最大値
# この値を越えるサイズのファイルはキャッシュとして保存しない
maximum_object_size_in_memory 20480 KB

# ディスク上に保存するキャッシュの最大値
maximum_object_size 20480 KB

# IPアドレスからFQDNに名前解決をした結果のキャッシュのエントリー数
fqdncache_size 10000

# FQDNからIPアドレスに名前解決をした結果のキャッシュのエントリー数
ipcache_size 10000

# キャッシュの保存先(100MBの容量を16分割しそれぞれに256のフォルダが切られその中にキャッシングされる)
cache_dir ufs /var/spool/squid 100 16 256
```
## 特定のページをキャッシュから除外
ある特定のページをキャッシュから除外する場合は次のようにします。
```
# github.comをキャッシュしない例
acl QUERY urlpath_regex cgi-bin \? github.com
no_cache deny QUERY
```
## Keep-Aliveの無効化
Squidサーバに複数IPを使って、複数ポートで分散させている場合に短期間にアクセスされると、キャッシュが残りIPが切り替わりません。
同じドメインに対して短い間隔で連続アクセスされた時に接続を使い回す仕様らしい。(i.e. IP分散が出来なくなってしまう)  
この現象を回避するために以下の設定が必要となります。
```
client_persistent_connections off
server_persistent_connections off
```
注意点としては、サーバ・クライアント間のセッションが大量に作成されるためサーバに負荷がかかります。  
そのため、セッションに関するチューニングも行いましょう。
## キャッシュ機能を無効化する方法
動的に更新されるWebページに対して、キャッシュされた情報が影響してうまく表示ができない場合があります。  
回線速度が十分に出ている場合はキャッシュを使わないというのも手だと思います。
```
acl NOCACHE src all
cache deny NOCACHE
```
